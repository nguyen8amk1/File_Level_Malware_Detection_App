#!/bin/bash

metadata_file="./oledata/test/file_status.csv"
file_status_normal="./oledata/file_status_normal.csv"

# Read metadata file and store benign and normal filenames
benign_files=()
normal_files=()
while IFS=, read -r filename status; do
	if [ "$status" -eq 1 ]; then
		benign_files+=("$filename")
	else
		normal_files+=("$filename")
	fi
done <"$metadata_file"

# Calculate 30% of the total number of benign and normal files
total_benign=${#benign_files[@]}
total_normal=${#normal_files[@]}
num_benign_to_select=$((total_benign * 30 / 100))
num_normal_to_select=$((total_normal * 30 / 100))

# Set a fixed seed for reproducibility
RANDOM=42

# Randomly select 30% of benign and normal files
selected_benign=($(printf "%s\n" "${benign_files[@]}" | shuf -n "$num_benign_to_select"))
selected_normal=($(printf "%s\n" "${normal_files[@]}" | shuf -n "$num_normal_to_select"))

# Write selected filenames and their statuses to file_status_normal.csv
>"$file_status_normal" # Clear the file before writing
for filename in "${selected_benign[@]}"; do
	echo "${filename},1" >>"$file_status_normal"
done
for filename in "${selected_normal[@]}"; do
	echo "${filename},0" >>"$file_status_normal"
done
