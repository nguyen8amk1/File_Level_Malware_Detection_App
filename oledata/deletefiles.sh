#!/bin/bash

# Names of the CSV files that list the needed files
csv_file1="./test/file_status_original.csv"
csv_file2="./train/file_status_original.csv"

# Create a temporary file to store the combined list of files to keep
combined_needed_files=$(mktemp)

# Read the CSV files and extract the filenames that need to be kept
awk -F, '{print $1}' "$csv_file1" >"$combined_needed_files"
awk -F, '{print $1}' "$csv_file2" >>"$combined_needed_files"

# Remove duplicate entries from the combined list
sort -u "$combined_needed_files" -o "$combined_needed_files"

# Create the "deleted" folder if it doesn't exist
mkdir -p deleted

# Get a list of all CSV files in the current directory
all_files=$(ls *.csv)

# Loop through all CSV files
for file in $all_files; do
	# Check if the file is in the combined list of needed files
	if ! grep -qx "$file" "$combined_needed_files"; then
		echo "Moving $file to deleted/"
		mv "$file" deleted/
	fi
done

# Clean up the temporary file
rm "$combined_needed_files"
